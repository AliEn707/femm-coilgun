# Скрипт для симуляции выстрела пушки гаусса в FEMM #
  * Здесь представлен переработанный и "причёсанный" скрипт, взятый с сайта [foar.ru](http://www.foar.ru/topic.php?forum=35&topic=1). Изменения по сравнению с оригинальным скриптом расписаны [по этой ссылке](http://femm-coilgun.googlecode.com/svn/trunk/changes.txt).
  * Что такое пушка гаусса [расписано в Wiki](http://ru.wikipedia.org/wiki/%D0%9F%D1%83%D1%88%D0%BA%D0%B0_%D0%93%D0%B0%D1%83%D1%81%D1%81%D0%B0)
  * Скрипт нужен для того, чтобы _перед постройкой_ пушки гаусса оценить параметры катушки, пули и конденсатора, а также подобрать оптимальные параметры.
  * **Скрипт умеет оптимизировать начальные параметры и находить такие при которых скорость выстрела выше**

## Необходимое ПО ##
Всё что нужно для работы скрипта можно скачать по следующим ссылкам:
  * [Программа FEMM](http://www.femm.info) - программа скачивается в разделе Download. Требуемая версия - 4.2.
  * [Скрипт для FEMM](http://femm-coilgun.googlecode.com/svn/trunk/coilgun.lua) ("Сохранить как..." на ссылке)
  * [Файл настроек](http://femm-coilgun.googlecode.com/svn/trunk/primer.txt) ("Сохранить как..." на ссылке)

## Подготовка ##
  * Устанавливаем программу FEMM
  * Записываем скрипт (coilgun.lua) и файл настроек (primer.txt) в один каталог

## Симуляция выстрела ##
Для начала надо отредактировать файл настроек под ваши параметры гаусса. Для этого открываем его в любом текстовом редакторе (например, блокноте). Файл выглядит следующим образом (формат файла не совпадает с оригинальным форматом):
```
--------------------------------------------------------------------------------
-- Введите начальные параметры. Версия скрипта 124
--------------------------------------------------------------------------------

-- Конденсатор
conf.c       = 900	-- мкФ, ёмкость конденсатора
conf.u       = 450	-- Вольт, напряжение конденсатора
conf.r_cc    = 0	-- Ом, ESR конденсатора (0 - использовать расчётное значение, иначе - значение в оммах)

-- Катушка
conf.d_pr    = 0.65	-- мм, диаметр провода без изоляции
conf.l_kat   = 20	-- мм, длина катушки
conf.d_kat   = 26	-- мм, внешний диаметр катушки
conf.d_stv   = 8.1	-- мм, внутренний диаметр катушки
conf.k_mot   = 0.74	-- плотность намотки (0.6-0.95, 0.74 - рекомендуется) или Число витков 	
conf.i_max   = 0	-- А, ограничение тока через катаушку (0 - без ограничения)

-- Магнитопровод
conf.l_mag   = 4	-- мм, толщина корпуса магнитопровода (ноль, если нет магнитопровода) 
conf.l_mag_y = 4	-- мм, толщина щёчек магнитопровода 
conf.k_ark   = 0.7	-- мм, толщина каркаса катушки

-- Пуля
conf.l_puli  = 20	-- мм, длина пули
conf.d_puli  = 8	-- мм, диаметр пули (если равен длине пули, то пуля считается шаром)
conf.l_otv   = 12	-- мм, глубина отверстия
conf.d_otv   = 4	-- мм, диаметр отверстия (0 - если без отверстия)
conf.nagr    = 0.1	-- г, масса доп.нагрузки или оперения (0 - если без нгрузки)
conf.l_sdv   = 1	-- мм, стартовая позиция пули в катушке (если до катушки, то с минусом)
conf.vel0    = 0.2	-- м/с, начальная скорость пули (если ноль, то укажите 0.1 или 0.2 - будет быстрее считать)

-- Ключ
conf.mode    = 0	-- режим расчёта, 0-без выключения тока (тиристор), 1-с выключением тока (транзистор)
conf.r_sw    = 0.3	-- Ом, сопротивление ключа

-- Симуляция
conf.delta_t = 50	-- мкс, интервал расчёта (используйте 20-50 мкс для медленной скорости и 5-10 мкс для быстрой)

-- Параметры оптимизации
conf.opt    = 0	-- Нужно ли оптимизировать полученные результаты (0 - нет, 1 - да)
conf.opt_t  = "vel"	-- Что именно надо оптимизировать ("vel" - скорость, "eff" - эффективность)
opt.l_kat   = nil	-- Оптимизация по длине катушки (nil - без оптимизации, <значение> мм - шаг для подбора оптимального значения)
opt.d_kat   = nil	-- Оптимизация по диаметру катушки (nil - без оптимизации, <значение> мм - шаг для подбора оптимального значения)
opt.l_sdv   = nil	-- Оптимизация по начальной позиции пули в катушке (nil - без оптимизации, <значение> мм - шаг для подбора оптимального значения)

-- на самом деле можно использовать вообще любые 
-- параметры оптимизации, которые есть в исходных параметрах 
-- расчёта. например если добавить
-- opt.l_puli = 1
-- то будет оптимизировать по длине пули с шагом в 1 мм
```
(про оптимизацию и настройку оптимизации [расписано по этой ссылке](Optimization.md))

После коррекции значений сохраняем файл обратно на диск.

Затем запускаем FEMM и выбираем в нём пункт меню "Open Lua Script":

![http://femm-coilgun.googlecode.com/svn/images/femm_open_lua_script.png](http://femm-coilgun.googlecode.com/svn/images/femm_open_lua_script.png)

Выбираем файл скрипта в диалоге:

![http://femm-coilgun.googlecode.com/svn/images/femm_open_script_file.png](http://femm-coilgun.googlecode.com/svn/images/femm_open_script_file.png)

И указываем имя файла настроек без расширения и нажимаем "Enter":

![http://femm-coilgun.googlecode.com/svn/images/femm_enter_conf_file_name.png](http://femm-coilgun.googlecode.com/svn/images/femm_enter_conf_file_name.png)

После чего начнётся процесс расчёта выстрела. В зависимости от мощности компьютера и значений, введённых в файле настроек, он может длится довольно долгое время. Так что наберитесь терпения. Если вы во время расчёта вдруг поняли, что ввели неправильные значения, то нажмите "Esc" на клавиатуре и процесс расчёта прервётся. Можно будет подредактирвоать файл настроек и начать всё заново.

Как только процесс расчёта закончится, программа выдаст такое сообщение:

![http://femm-coilgun.googlecode.com/svn/images/femm_end_simulation.png](http://femm-coilgun.googlecode.com/svn/images/femm_end_simulation.png)

Из него видно, что результаты расчёта записаны в файл "primer V = 12.28078711816022.txt". Идём каталог, в который мы записали скрипт и видим, что там действительно лежит этот файл. Открываем его в любом текстовом редакторе. Верхняя часть файла выглядит следующим образом:
```
------------------------------------------------------------
Начало расчёта 07/22/12 15:26:45
Конец расчёта  07/22/12 15:31:58
Версия скрипта 119
Общее время, микросекунд  = 2500
Интервал расчёта,  мкс    = 50
Ёмкость конденсатора, мкФ = 2500.0
Начальное напряжение, В   = 310.0
Общее сопротивление, Ом   = 1.465
Внешнее сопротивление, Ом = 0.356

----- ПРОВОД ---------------------------------------------
Сопротивление обмотки, Ом = 1.109
Количество витков         = 194
Диаметр провода, мм       = 0.40
Общая длина провода, м    = 8.0

----- КАТУШКА --------------------------------------------
Длина катушки, мм                            = 16.0
Внешний диаметр катушки, мм                  = 18.0
Индуктивность катушки в старт. позиции, мкГн = 321.8
Толщина щёчек внешнего магнитопровода, мм    = 3.0
Толщина корпуса внешнего магнитопровода, мм  = 1.5
Внутренний диаметр катушки, мм               = 8.1

----- ПУЛЯ --------------------------------------------
Масса пули без оперения, г       = 5.19
Длина пули, мм                   = 20.0
Диаметр пули, мм                 = 8.0
Глубина отверстия в пуле, мм     = 12.0
Диаметр отверстия, мм            = 6.00
Масса оперения, г                = 3.00
Масса пули вместе с оперением, г = 8.19
Стартовая позиция пули, мм       = 0.0

----- ЭНЕРГИЯ ------------------------------------------
Энергия пули начальная, Дж         = 0.4
Энергия пули  конечная, Дж         = 0.6
Приращение энергии пули, Дж        = 0.2
Энергия конденсатора начальная, Дж = 120.1
Энергия конденсатора конечная, Дж  = 31.5
Расход энергии конденсатора, Дж    = 88.6
Средняя сила, Н                    = 7.3
КПД, %                             = 0.24

------ СКОРОСТЬ ----------------------------------------
Начальная скорость пули, м/с    = 10.0
Конечная скорость пули, м/с     = 12.3
Максимальная скорость пули, м/с = 23.8
```

Самые важные для гауссостроителя разделы в этом файле - "ЭНЕРГИЯ" и "СКОРОСТЬ". В них надо смотреть "Энергия пули  конечная", "КПД" и "Конечная скорость пули".

Далее в файле идёт таблица параметров, измеренных в процессе симуляции:
```
------ Data of simulation -------------------------------
    Ток(А)    Напр(В)    Сила(Н) Скор.(м/с)   Поз.(мм) Врем.(мкс)
      50.2      309.0       0.00      10.00      0.500         50
      84.4      307.3      16.27      10.10      1.000        100
     114.9      305.0      57.19      10.45      1.505        150
     139.2      302.2      95.84      11.03      2.027        200
     157.1      299.1     124.95      11.80      2.579        250
     170.0      295.7     147.91      12.70      3.169        300
     179.2      292.1     165.72      13.71      3.804        350
     185.3      288.4     179.77      14.81      4.489        400
     189.2      284.6     189.79      15.96      5.229        450
     191.2      280.8     194.62      17.15      6.028        500
     191.9      276.9     189.44      18.31      6.885        550
     191.5      273.1     174.44      19.37      7.801        600
     190.4      269.3     155.66      20.32      8.769        650
     188.9      265.5     137.19      21.16      9.785        700
     187.0      261.8     119.88      21.89     10.843        750
     184.9      258.1     102.96      22.52     11.938        800
     182.6      254.4      85.47      23.04     13.063        850
     180.1      250.8      66.19      23.44     14.215        900
     177.6      247.3      44.03      23.71     15.388        950
     174.8      243.8      18.37      23.82     16.573       1000
     172.2      240.3     -24.79      23.67     17.764       1050
     169.3      237.0     -78.14      23.20     18.948       1100
     166.1      233.6    -108.19      22.54     20.108       1150
     163.3      230.4    -141.46      21.67     21.235       1200
     160.7      227.2    -143.04      20.80     22.318       1250
     158.3      224.0    -139.43      19.95     23.358       1300
     155.8      220.9    -129.08      19.16     24.356       1350
     155.1      217.8    -106.82      18.51     25.314       1400
     154.4      214.7     -86.16      17.98     26.239       1450
     152.8      211.6     -81.28      17.49     27.138       1500
     150.7      208.6     -79.51      17.00     28.013       1550
     148.6      205.6     -77.95      16.53     28.863       1600
     146.4      202.7     -76.49      16.06     29.689       1650
     144.3      199.8     -74.63      15.61     30.492       1700
     142.2      197.0     -72.70      15.16     31.273       1750
     140.1      194.2     -70.25      14.73     32.031       1800
     138.0      191.4     -67.36      14.32     32.767       1850
     135.9      188.7     -64.11      13.93     33.484       1900
     133.9      186.0     -60.38      13.56     34.180       1950
     131.8      183.4     -56.48      13.22     34.858       2000
     129.7      180.8     -51.78      12.90     35.519       2050
     127.4      178.3     -45.99      12.62     36.164       2100
     125.6      175.7     -28.95      12.44     36.795       2150
     124.5      173.3     -11.55      12.37     37.418       2200
     123.8      170.8      -5.56      12.34     38.036       2250
     122.5      168.3      -3.71      12.32     38.653       2300
     121.0      165.9      -2.48      12.30     39.269       2350
     119.2      163.5      -1.71      12.29     39.884       2400
     117.5      161.2      -1.12      12.29     40.499       2450
       0.0      158.9      -0.79      12.28     41.113       2500
```

Эти параметры полезны, чтобы оценить
  * не был ли превышен максимальный ток, на который рассчитаны электронные ключи
  * как долго на снаряд действовала отрицательная сила (замедляя его при вылете из катушки)

Ещё ниже в файле идёт раздел, который можно "скопипастить" в MS Excel и построить там красивые графики скорости, силы, тока и т.п. :)

## Рекомендации ##
Если результат симуляции не устраивает, то можно поменять один или несколько параметров в файле настроек и запустить симуляцию заново или же воспользоваться возможностью оптимизации.

## Обсуждение ##
Работу скрипта можно обсудить в следующих форумах:
  * [http://future-weapons.ru/forum/](http://future-weapons.ru/forum/viewtopic.php?f=20&t=521)
  * [http://www.offtop.ru/gauss2k/](http://www.offtop.ru/gauss2k/v1_271412__.php)
  * [http://www.foar.ru](http://www.foar.ru/topic.php?forum=36&topic=26)

## Планы на будущее ##
  * Улучшить алгоритм оптимизации
  * Научить скрипт считать, а также оптимизировать параметры для многоступенчатого гаусса